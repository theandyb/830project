---
title: "Data Exploration"
output: html_notebook
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(hms)
```

```{r}
df <- read_csv("data/marathon-data.csv")
names(df)[3] <- "firstHalf"
head(df)
```

```{r}
secs_per_mile <- function(x, distance){
  secs <- (3600 * hour(x)) + (60 * minute(x)) + second(x)
  secs_per_mile <- secs / distance
  return(secs_per_mile)
}

is_bq <- function(x, gender, age){
  if(gender == "M"){
    if(age <= 35 & x < hms(00, 5, 3)) return(1)
    else if( age > 35 & age <= 39 & x < hms(00, 10, 3)) return(1)
    else if( age > 39 & age <= 44 & x < hms(00, 15, 3)) return(1)
    else if( age > 44 & age <= 49 & x < hms(00, 25, 3)) return(1)
    else if( age > 49 & age <= 54 & x < hms(00, 30, 3)) return(1)
    else if( age > 54 & age <= 59 & x < hms(00, 40, 3)) return(1)
    else if( age > 59 & age <= 64 & x < hms(00, 55, 3)) return(1)
    else if( age > 64 & age <= 69 & x < hms(00, 10, 4)) return(1)
    else if( age > 69 & age <= 74 & x < hms(00, 25, 4)) return(1)
    else if( age > 74 & age <= 79 & x < hms(00, 40, 4)) return(1)
    else if( age > 79 & x < hms(00, 55, 4)) return(1)
    else return(0)
  } else {
    if(age <= 34 & x < hms(00, 35, 3)) return(1)
    else if( age > 34 & age <= 39 & x < hms(00, 40, 3)) return(1)
    else if( age > 39 & age <= 44 & x < hms(00, 45, 3)) return(1)
    else if( age > 44 & age <= 49 & x < hms(00, 55, 3)) return(1)
    else if( age > 49 & age <= 54 & x < hms(00, 00, 4)) return(1)
    else if( age > 54 & age <= 59 & x < hms(00, 10, 4)) return(1)
    else if( age > 59 & age <= 64 & x < hms(00, 25, 4)) return(1)
    else if( age > 64 & age <= 69 & x < hms(00, 40, 4)) return(1)
    else if( age > 69 & age <= 74 & x < hms(00, 55, 4)) return(1)
    else if( age > 74 & age <= 79 & x < hms(00, 10, 5)) return(1)
    else if( age > 79 & x < hms(00, 25, 5)) return(1)
    else return(0)
  }
}

df <- df %>% mutate(halfPace = secs_per_mile(split, 13.1),
                    fullPace = secs_per_mile(final, 26.2),
                    secondHalf = hms(as.numeric(final - split)),
                    secondHalfPace = secs_per_mile(secondHalf, 13.1))
df <- df %>% 
  rowwise() %>% 
  mutate(BQ = is_bq(final, gender, age))
```

